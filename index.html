<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adivinar N√∫mero ‚Äì Daltonismo Friendly</title>
<style>
body {font-family: Arial,sans-serif; display:flex; flex-direction:column; align-items:center; min-height:100vh; background:#000; margin:0; color:white; padding:20px; box-sizing:border-box;}
.container {background:#111; padding:20px; width:100%; max-width:420px; text-align:center; border-radius:10px; box-shadow:0 0 10px #000;}
h1 { margin:0 0 10px 0;}
.warning {background:#222; padding:8px; color:#FFE600; font-size:15px; border-radius:6px; margin-bottom:10px; font-weight:bold;}
.config-row {display:flex; gap:8px; margin-bottom:10px;}
.btn-settings, .btn-resetgame {flex:1; padding:10px; background:#333; color:white; border:none; border-radius:6px; font-size:16px; cursor:pointer;}
.settings-box {background:#222; padding:12px; border-radius:8px; margin-bottom:12px; display:none; text-align:left;}
.settings-box label {color:#fff; display:block; margin-bottom:8px; font-size:15px;}
.settings-box select, .settings-box input[type="checkbox"] {margin-right:8px;}
#modoTxt {margin-bottom:12px; font-size:15px; color:#00e5ff; font-weight:bold;}
input#inputGuess {width:100%; font-size:26px; text-align:center; padding:10px; margin-bottom:12px; background:#fff; color:#000; border-radius:6px; border:none; box-sizing:border-box;}
.keyboard {display:flex; flex-wrap:wrap; justify-content:center; gap:6px;}
.keyboard button {width:30%; padding:10px; font-size:20px; border-radius:6px; border:none; cursor:pointer;}
.btn-clear {background:#777; color:white;}
.btn-ok {background:#4CAF50; color:white;}
.correct, .misplaced, .wrong {
    display: inline-block;
    font-weight: bold;
    line-height: 2;
    margin: 2px;
    border-radius: 8px;
}
.cuatro { font-size: 24px; padding: 8px 12px; }
.cinco { font-size: 20px; padding: 6px 10px; }

.correct { background: #0057FF; color: white; }
.misplaced { background: #FF2B2B; color: white; }
.wrong { background: #BFBFBF; color: black; }

.info-box {display:flex; justify-content:space-between; margin-bottom:10px; background:#222; padding:5px 10px; border-radius:5px; font-size:14px;}
#attempts {margin-top:12px; text-align:left; max-height:180px; overflow:auto;}
#result {margin-top:10px; min-height:30px;}
footer {margin-top:14px; text-align:center; font-size:12px; color:#aaa; padding:10px 0; width:100%; max-width:420px;}
footer img.logo-footer {max-width:150px; width:60%; height:auto; display:block; margin:6px auto;}
@media (max-width:420px){.keyboard button{font-size:18px; padding:9px;} .container{padding:14px;}}
</style>
</head>
<body>
<div class="container">
<h1>Adivin√° el n√∫mero</h1>
<div class="warning">‚ö† Los n√∫meros pueden repetirse o no seg√∫n configuraci√≥n</div>

<div class="config-row">
    <button class="btn-settings" onclick="toggleSettings()">‚öô Configuraci√≥n</button>
</div>

<div id="settingsBox" class="settings-box">
    <label>
        Cifras:
        <select id="selCifras" onchange="guardarSettings()">
            <option value="4" selected>4 cifras</option>
            <option value="5">5 cifras</option>
        </select>
    </label>
    <label><input type="checkbox" id="chkRepetir" onchange="guardarSettings()"> Permitir n√∫meros repetidos</label>
    <button class="btn-resetgame" onclick="guardarSettings()">Guardar configuraci√≥n</button>
</div>

<div id="modoTxt">Modo actual: 4 cifras ¬∑ Repetidos: NO</div>
<p id="txtCifras">Intent√° adivinar un n√∫mero de 4 cifras</p>

<div class="info-box">
    <span>‚è± Tiempo: <b id="time">0.0s</b></span>
    <span>üèÜ R√©cord: <b id="record">--</b></span>
</div>

<input type="text" id="inputGuess" maxlength="4" readonly placeholder="----">
<div class="keyboard" id="keyboard">
    <button onclick="addNum('1')">1</button>
    <button onclick="addNum('2')">2</button>
    <button onclick="addNum('3')">3</button>
    <button onclick="addNum('4')">4</button>
    <button onclick="addNum('5')">5</button>
    <button onclick="addNum('6')">6</button>
    <button onclick="addNum('7')">7</button>
    <button onclick="addNum('8')">8</button>
    <button onclick="addNum('9')">9</button>
    <button onclick="addNum('0')">0</button>
    <button class="btn-clear" onclick="clearInput()">RESET</button>
    <button class="btn-ok" onclick="checkGuess()">ENTER</button>
</div>

<div id="attempts"></div>
<div id="result"></div>
<button id="btnNuevo" class="btn-resetgame" onclick="resetGame()">üîÑ Nuevo Juego</button>
<button id="btnResetRecord" class="btn-resetgame" onclick="resetRecord()">üßπ Reset Record</button>

<h3>Top 5</h3>
<div id="top5"></div>
</div>
<footer class="footer">
    <img src="imagenes/macher.png" class="logo-footer" alt="Logo">
    <p>&copy; Copyright mm@cher - 2025</p>
</footer>

<script>
let permitirRepetidos=false, cifras=4, secret="", intentos=0, startTime=null, timer=null;
let records = JSON.parse(localStorage.getItem("records")) || {4:[],5:[]};

function toggleSettings(){ const box=document.getElementById("settingsBox"); box.style.display=(box.style.display==="none"||box.style.display==="")?"block":"none"; }
function guardarSettings(){ 
    cifras=parseInt(document.getElementById("selCifras").value); 
    permitirRepetidos=document.getElementById("chkRepetir").checked; 
    document.getElementById("txtCifras").textContent="Intent√° adivinar un n√∫mero de "+cifras+" cifras"; 
    document.getElementById("inputGuess").maxLength=cifras; 
    document.getElementById("modoTxt").textContent=`Modo actual: ${cifras} cifras ¬∑ Repetidos: ${permitirRepetidos?"S√ç":"NO"}`; 
    toggleSettings(); resetGame(); actualizarRecords(); 
}

function generarNumero(){ 
    let arr=[]; 
    while(arr.length<cifras){ 
        let n=Math.floor(Math.random()*10); 
        if(!permitirRepetidos && arr.includes(n)) continue; 
        arr.push(n); 
    } 
    return arr.join(""); 
}

function addNum(n){ if(!startTime) iniciarTiempo(); const input=document.getElementById("inputGuess"); if(input.value.length<cifras) input.value+=n; }
function clearInput(){document.getElementById("inputGuess").value="";}
function iniciarTiempo(){ startTime=Date.now(); timer=setInterval(()=>{document.getElementById("time").textContent=((Date.now()-startTime)/1000).toFixed(1)+"s"; },100);}
function detenerTiempo(){clearInterval(timer);}

function checkGuess(){
    let guess=document.getElementById("inputGuess").value;
    if(guess.length!==cifras){ alert("Ingres√° "+cifras+" n√∫meros"); return; }
    if(!permitirRepetidos && (new Set(guess).size!==guess.length)){ alert("No est√°n permitidos n√∫meros repetidos."); return; }
    intentos++;
    let secretCount={}, usedSecret={}, marks=new Array(cifras).fill(null);
    for(let d of secret) secretCount[d]=(secretCount[d]||0)+1;

    let clase = cifras===4 ? 'cuatro' : 'cinco';

    for(let i=0;i<cifras;i++){
        if(guess[i]===secret[i]){
            marks[i]=`<span class="correct ${clase}">${guess[i]} ‚úì</span>`;
            usedSecret[guess[i]]=(usedSecret[guess[i]]||0)+1;
        }
    }
    for(let i=0;i<cifras;i++){
        if(marks[i]) continue;
        let g=guess[i], total=secretCount[g]||0, used=usedSecret[g]||0;
        if(total>used){
            marks[i]=`<span class="misplaced ${clase}">${g} ‚Üª</span>`;
            usedSecret[g]=used+1;
        } else {
            marks[i]=`<span class="wrong ${clase}">${g}</span>`;
        }
    }

    document.getElementById("attempts").innerHTML=`<div>Intento ${intentos}: ${marks.join(" ")}</div>`+document.getElementById("attempts").innerHTML;

    if(guess===secret){
        detenerTiempo();
        const tiempo=(Date.now()-startTime)/1000;
        alert("üéâ ¬°Ganaste! El n√∫mero era "+secret+" en "+tiempo.toFixed(1)+"s");
        guardarRecord(tiempo); bloquear(); return;
    }
    if(intentos>=10){ detenerTiempo(); alert("‚ùå Perdiste. El n√∫mero era "+secret); bloquear(); }
    clearInput();
}

function bloquear(){ document.querySelectorAll("button").forEach(b=>{ if(b.id!=="btnNuevo" && b.id!=="btnResetRecord") b.disabled=true; }); }

function resetGame(){ 
    secret=generarNumero(); intentos=0; startTime=null; clearInterval(timer); timer=null; 
    document.getElementById("time").textContent="0.0s"; 
    document.getElementById("inputGuess").value=""; 
    document.getElementById("attempts").innerHTML=""; 
    document.getElementById("result").innerHTML=""; 
    document.querySelectorAll("button").forEach(b=>b.disabled=false); 
    document.getElementById("inputGuess").maxLength=cifras; 
    document.getElementById("txtCifras").textContent="Intent√° adivinar un n√∫mero de "+cifras+" cifras"; 
    actualizarRecords(); 
    console.log("NUEVO SECRETO:",secret); 
}

function guardarRecord(tiempo){ 
    let arr=records[cifras]; 
    arr.push(tiempo.toFixed(1)); 
    arr.sort((a,b)=>a-b); 
    if(arr.length>5) arr=arr.slice(0,5); 
    records[cifras]=arr; 
    localStorage.setItem("records", JSON.stringify(records)); 
    actualizarRecords(); 
}

function actualizarRecords(){ 
    const div=document.getElementById("top5"); 
    const arr=records[cifras]||[]; 
    if(arr.length===0){ div.innerHTML="<p>No hay r√©cords a√∫n</p>"; document.getElementById("record").textContent="--"; return;} 
    div.innerHTML=arr.map((t,i)=>`<div>${i+1}. ${t}s</div>`).join(""); 
    document.getElementById("record").textContent=arr[0]+"s"; 
}

function resetRecord(){ 
    records[cifras]=[]; 
    localStorage.setItem("records", JSON.stringify(records)); 
    actualizarRecords(); 
}

function initFromDefaults(){ 
    document.getElementById("chkRepetir").checked=permitirRepetidos; 
    document.getElementById("selCifras").value=cifras; 
    resetGame(); 
    actualizarRecords(); 
}

initFromDefaults();
</script>
</body>
</html>
